'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.formatSummary = formatSummary;

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _duration = require('duration');

var _duration2 = _interopRequireDefault(_duration);

var _status = require('../../status');

var _status2 = _interopRequireDefault(_status);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var STATUS_REPORT_ORDER = [_status2.default.FAILED, _status2.default.AMBIGUOUS, _status2.default.UNDEFINED, _status2.default.PENDING, _status2.default.SKIPPED, _status2.default.PASSED];

function formatSummary(_ref) {
  var colorFns = _ref.colorFns,
      testCaseMap = _ref.testCaseMap,
      testRun = _ref.testRun;

  var testCaseResults = [];
  var testStepResults = [];
  _lodash2.default.each(testCaseMap, function (_ref2) {
    var result = _ref2.result,
        steps = _ref2.steps;

    testCaseResults.push(result);
    _lodash2.default.each(steps, function (testStep) {
      if (testStep.sourceLocation) {
        testStepResults.push(testStep.result);
      }
    });
  });
  var scenarioSummary = getCountSummary({
    colorFns: colorFns,
    objects: testCaseResults,
    type: 'scenario'
  });
  var stepSummary = getCountSummary({
    colorFns: colorFns,
    objects: testStepResults,
    type: 'step'
  });
  var durationSummary = getDuration(testRun.result.duration);
  return [scenarioSummary, stepSummary, durationSummary].join('\n');
}

function getCountSummary(_ref3) {
  var colorFns = _ref3.colorFns,
      objects = _ref3.objects,
      type = _ref3.type;

  var counts = _lodash2.default.chain(objects).groupBy('status').mapValues('length').value();
  var total = _lodash2.default.reduce(counts, function (memo, value) {
    return memo + value;
  }) || 0;
  var text = total + ' ' + type + (total === 1 ? '' : 's');
  if (total > 0) {
    var details = [];
    STATUS_REPORT_ORDER.forEach(function (status) {
      if (counts[status] > 0) {
        details.push(colorFns[status](counts[status] + ' ' + status));
      }
    });
    text += ' (' + details.join(', ') + ')';
  }
  return text;
}

function getDuration(milliseconds) {
  var start = new Date(0);
  var end = new Date(milliseconds);
  var duration = new _duration2.default(start, end);

  return duration.minutes + 'm' + duration.toString('%S') + '.' + duration.toString('%L') + 's' + '\n';
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9mb3JtYXR0ZXIvaGVscGVycy9zdW1tYXJ5X2hlbHBlcnMuanMiXSwibmFtZXMiOlsiZm9ybWF0U3VtbWFyeSIsIlNUQVRVU19SRVBPUlRfT1JERVIiLCJGQUlMRUQiLCJBTUJJR1VPVVMiLCJVTkRFRklORUQiLCJQRU5ESU5HIiwiU0tJUFBFRCIsIlBBU1NFRCIsImNvbG9yRm5zIiwidGVzdENhc2VNYXAiLCJ0ZXN0UnVuIiwidGVzdENhc2VSZXN1bHRzIiwidGVzdFN0ZXBSZXN1bHRzIiwiZWFjaCIsInJlc3VsdCIsInN0ZXBzIiwicHVzaCIsInRlc3RTdGVwIiwic291cmNlTG9jYXRpb24iLCJzY2VuYXJpb1N1bW1hcnkiLCJnZXRDb3VudFN1bW1hcnkiLCJvYmplY3RzIiwidHlwZSIsInN0ZXBTdW1tYXJ5IiwiZHVyYXRpb25TdW1tYXJ5IiwiZ2V0RHVyYXRpb24iLCJkdXJhdGlvbiIsImpvaW4iLCJjb3VudHMiLCJjaGFpbiIsImdyb3VwQnkiLCJtYXBWYWx1ZXMiLCJ2YWx1ZSIsInRvdGFsIiwicmVkdWNlIiwibWVtbyIsInRleHQiLCJkZXRhaWxzIiwiZm9yRWFjaCIsInN0YXR1cyIsIm1pbGxpc2Vjb25kcyIsInN0YXJ0IiwiRGF0ZSIsImVuZCIsIm1pbnV0ZXMiLCJ0b1N0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7UUFhZ0JBLGEsR0FBQUEsYTs7QUFiaEI7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7QUFFQSxJQUFNQyxzQkFBc0IsQ0FDMUIsaUJBQU9DLE1BRG1CLEVBRTFCLGlCQUFPQyxTQUZtQixFQUcxQixpQkFBT0MsU0FIbUIsRUFJMUIsaUJBQU9DLE9BSm1CLEVBSzFCLGlCQUFPQyxPQUxtQixFQU0xQixpQkFBT0MsTUFObUIsQ0FBNUI7O0FBU08sU0FBU1AsYUFBVCxPQUEyRDtBQUFBLE1BQWxDUSxRQUFrQyxRQUFsQ0EsUUFBa0M7QUFBQSxNQUF4QkMsV0FBd0IsUUFBeEJBLFdBQXdCO0FBQUEsTUFBWEMsT0FBVyxRQUFYQSxPQUFXOztBQUNoRSxNQUFNQyxrQkFBa0IsRUFBeEI7QUFDQSxNQUFNQyxrQkFBa0IsRUFBeEI7QUFDQSxtQkFBRUMsSUFBRixDQUFPSixXQUFQLEVBQW9CLGlCQUF1QjtBQUFBLFFBQXBCSyxNQUFvQixTQUFwQkEsTUFBb0I7QUFBQSxRQUFaQyxLQUFZLFNBQVpBLEtBQVk7O0FBQ3pDSixvQkFBZ0JLLElBQWhCLENBQXFCRixNQUFyQjtBQUNBLHFCQUFFRCxJQUFGLENBQU9FLEtBQVAsRUFBYyxvQkFBWTtBQUN4QixVQUFJRSxTQUFTQyxjQUFiLEVBQTZCO0FBQzNCTix3QkFBZ0JJLElBQWhCLENBQXFCQyxTQUFTSCxNQUE5QjtBQUNEO0FBQ0YsS0FKRDtBQUtELEdBUEQ7QUFRQSxNQUFNSyxrQkFBa0JDLGdCQUFnQjtBQUN0Q1osc0JBRHNDO0FBRXRDYSxhQUFTVixlQUY2QjtBQUd0Q1csVUFBTTtBQUhnQyxHQUFoQixDQUF4QjtBQUtBLE1BQU1DLGNBQWNILGdCQUFnQjtBQUNsQ1osc0JBRGtDO0FBRWxDYSxhQUFTVCxlQUZ5QjtBQUdsQ1UsVUFBTTtBQUg0QixHQUFoQixDQUFwQjtBQUtBLE1BQU1FLGtCQUFrQkMsWUFBWWYsUUFBUUksTUFBUixDQUFlWSxRQUEzQixDQUF4QjtBQUNBLFNBQU8sQ0FBQ1AsZUFBRCxFQUFrQkksV0FBbEIsRUFBK0JDLGVBQS9CLEVBQWdERyxJQUFoRCxDQUFxRCxJQUFyRCxDQUFQO0FBQ0Q7O0FBRUQsU0FBU1AsZUFBVCxRQUFzRDtBQUFBLE1BQTNCWixRQUEyQixTQUEzQkEsUUFBMkI7QUFBQSxNQUFqQmEsT0FBaUIsU0FBakJBLE9BQWlCO0FBQUEsTUFBUkMsSUFBUSxTQUFSQSxJQUFROztBQUNwRCxNQUFNTSxTQUFTLGlCQUFFQyxLQUFGLENBQVFSLE9BQVIsRUFBaUJTLE9BQWpCLENBQXlCLFFBQXpCLEVBQW1DQyxTQUFuQyxDQUE2QyxRQUE3QyxFQUF1REMsS0FBdkQsRUFBZjtBQUNBLE1BQU1DLFFBQVEsaUJBQUVDLE1BQUYsQ0FBU04sTUFBVCxFQUFpQixVQUFDTyxJQUFELEVBQU9ILEtBQVA7QUFBQSxXQUFpQkcsT0FBT0gsS0FBeEI7QUFBQSxHQUFqQixLQUFtRCxDQUFqRTtBQUNBLE1BQUlJLE9BQU9ILFFBQVEsR0FBUixHQUFjWCxJQUFkLElBQXNCVyxVQUFVLENBQVYsR0FBYyxFQUFkLEdBQW1CLEdBQXpDLENBQVg7QUFDQSxNQUFJQSxRQUFRLENBQVosRUFBZTtBQUNiLFFBQU1JLFVBQVUsRUFBaEI7QUFDQXBDLHdCQUFvQnFDLE9BQXBCLENBQTRCLGtCQUFVO0FBQ3BDLFVBQUlWLE9BQU9XLE1BQVAsSUFBaUIsQ0FBckIsRUFBd0I7QUFDdEJGLGdCQUFRckIsSUFBUixDQUFhUixTQUFTK0IsTUFBVCxFQUFpQlgsT0FBT1csTUFBUCxJQUFpQixHQUFqQixHQUF1QkEsTUFBeEMsQ0FBYjtBQUNEO0FBQ0YsS0FKRDtBQUtBSCxZQUFRLE9BQU9DLFFBQVFWLElBQVIsQ0FBYSxJQUFiLENBQVAsR0FBNEIsR0FBcEM7QUFDRDtBQUNELFNBQU9TLElBQVA7QUFDRDs7QUFFRCxTQUFTWCxXQUFULENBQXFCZSxZQUFyQixFQUFtQztBQUNqQyxNQUFNQyxRQUFRLElBQUlDLElBQUosQ0FBUyxDQUFULENBQWQ7QUFDQSxNQUFNQyxNQUFNLElBQUlELElBQUosQ0FBU0YsWUFBVCxDQUFaO0FBQ0EsTUFBTWQsV0FBVyx1QkFBYWUsS0FBYixFQUFvQkUsR0FBcEIsQ0FBakI7O0FBRUEsU0FDRWpCLFNBQVNrQixPQUFULEdBQ0EsR0FEQSxHQUVBbEIsU0FBU21CLFFBQVQsQ0FBa0IsSUFBbEIsQ0FGQSxHQUdBLEdBSEEsR0FJQW5CLFNBQVNtQixRQUFULENBQWtCLElBQWxCLENBSkEsR0FLQSxHQUxBLEdBTUEsSUFQRjtBQVNEIiwiZmlsZSI6InN1bW1hcnlfaGVscGVycy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCdcbmltcG9ydCBEdXJhdGlvbiBmcm9tICdkdXJhdGlvbidcbmltcG9ydCBTdGF0dXMgZnJvbSAnLi4vLi4vc3RhdHVzJ1xuXG5jb25zdCBTVEFUVVNfUkVQT1JUX09SREVSID0gW1xuICBTdGF0dXMuRkFJTEVELFxuICBTdGF0dXMuQU1CSUdVT1VTLFxuICBTdGF0dXMuVU5ERUZJTkVELFxuICBTdGF0dXMuUEVORElORyxcbiAgU3RhdHVzLlNLSVBQRUQsXG4gIFN0YXR1cy5QQVNTRURcbl1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdFN1bW1hcnkoeyBjb2xvckZucywgdGVzdENhc2VNYXAsIHRlc3RSdW4gfSkge1xuICBjb25zdCB0ZXN0Q2FzZVJlc3VsdHMgPSBbXVxuICBjb25zdCB0ZXN0U3RlcFJlc3VsdHMgPSBbXVxuICBfLmVhY2godGVzdENhc2VNYXAsICh7IHJlc3VsdCwgc3RlcHMgfSkgPT4ge1xuICAgIHRlc3RDYXNlUmVzdWx0cy5wdXNoKHJlc3VsdClcbiAgICBfLmVhY2goc3RlcHMsIHRlc3RTdGVwID0+IHtcbiAgICAgIGlmICh0ZXN0U3RlcC5zb3VyY2VMb2NhdGlvbikge1xuICAgICAgICB0ZXN0U3RlcFJlc3VsdHMucHVzaCh0ZXN0U3RlcC5yZXN1bHQpXG4gICAgICB9XG4gICAgfSlcbiAgfSlcbiAgY29uc3Qgc2NlbmFyaW9TdW1tYXJ5ID0gZ2V0Q291bnRTdW1tYXJ5KHtcbiAgICBjb2xvckZucyxcbiAgICBvYmplY3RzOiB0ZXN0Q2FzZVJlc3VsdHMsXG4gICAgdHlwZTogJ3NjZW5hcmlvJ1xuICB9KVxuICBjb25zdCBzdGVwU3VtbWFyeSA9IGdldENvdW50U3VtbWFyeSh7XG4gICAgY29sb3JGbnMsXG4gICAgb2JqZWN0czogdGVzdFN0ZXBSZXN1bHRzLFxuICAgIHR5cGU6ICdzdGVwJ1xuICB9KVxuICBjb25zdCBkdXJhdGlvblN1bW1hcnkgPSBnZXREdXJhdGlvbih0ZXN0UnVuLnJlc3VsdC5kdXJhdGlvbilcbiAgcmV0dXJuIFtzY2VuYXJpb1N1bW1hcnksIHN0ZXBTdW1tYXJ5LCBkdXJhdGlvblN1bW1hcnldLmpvaW4oJ1xcbicpXG59XG5cbmZ1bmN0aW9uIGdldENvdW50U3VtbWFyeSh7IGNvbG9yRm5zLCBvYmplY3RzLCB0eXBlIH0pIHtcbiAgY29uc3QgY291bnRzID0gXy5jaGFpbihvYmplY3RzKS5ncm91cEJ5KCdzdGF0dXMnKS5tYXBWYWx1ZXMoJ2xlbmd0aCcpLnZhbHVlKClcbiAgY29uc3QgdG90YWwgPSBfLnJlZHVjZShjb3VudHMsIChtZW1vLCB2YWx1ZSkgPT4gbWVtbyArIHZhbHVlKSB8fCAwXG4gIGxldCB0ZXh0ID0gdG90YWwgKyAnICcgKyB0eXBlICsgKHRvdGFsID09PSAxID8gJycgOiAncycpXG4gIGlmICh0b3RhbCA+IDApIHtcbiAgICBjb25zdCBkZXRhaWxzID0gW11cbiAgICBTVEFUVVNfUkVQT1JUX09SREVSLmZvckVhY2goc3RhdHVzID0+IHtcbiAgICAgIGlmIChjb3VudHNbc3RhdHVzXSA+IDApIHtcbiAgICAgICAgZGV0YWlscy5wdXNoKGNvbG9yRm5zW3N0YXR1c10oY291bnRzW3N0YXR1c10gKyAnICcgKyBzdGF0dXMpKVxuICAgICAgfVxuICAgIH0pXG4gICAgdGV4dCArPSAnICgnICsgZGV0YWlscy5qb2luKCcsICcpICsgJyknXG4gIH1cbiAgcmV0dXJuIHRleHRcbn1cblxuZnVuY3Rpb24gZ2V0RHVyYXRpb24obWlsbGlzZWNvbmRzKSB7XG4gIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoMClcbiAgY29uc3QgZW5kID0gbmV3IERhdGUobWlsbGlzZWNvbmRzKVxuICBjb25zdCBkdXJhdGlvbiA9IG5ldyBEdXJhdGlvbihzdGFydCwgZW5kKVxuXG4gIHJldHVybiAoXG4gICAgZHVyYXRpb24ubWludXRlcyArXG4gICAgJ20nICtcbiAgICBkdXJhdGlvbi50b1N0cmluZygnJVMnKSArXG4gICAgJy4nICtcbiAgICBkdXJhdGlvbi50b1N0cmluZygnJUwnKSArXG4gICAgJ3MnICtcbiAgICAnXFxuJ1xuICApXG59XG4iXX0=