'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _defineProperty2 = require('babel-runtime/helpers/defineProperty');

var _defineProperty3 = _interopRequireDefault(_defineProperty2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _PrettyFormatter$CHAR;

var _data_table = require('../models/step_arguments/data_table');

var _data_table2 = _interopRequireDefault(_data_table);

var _doc_string = require('../models/step_arguments/doc_string');

var _doc_string2 = _interopRequireDefault(_doc_string);

var _figures = require('figures');

var _figures2 = _interopRequireDefault(_figures);

var _hook = require('../models/hook');

var _hook2 = _interopRequireDefault(_hook);

var _status = require('../status');

var _status2 = _interopRequireDefault(_status);

var _summary_formatter = require('./summary_formatter');

var _summary_formatter2 = _interopRequireDefault(_summary_formatter);

var _cliTable = require('cli-table');

var _cliTable2 = _interopRequireDefault(_cliTable);

var _indentString = require('indent-string');

var _indentString2 = _interopRequireDefault(_indentString);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var PrettyFormatter = function (_SummaryFormatter) {
  (0, _inherits3.default)(PrettyFormatter, _SummaryFormatter);

  function PrettyFormatter() {
    (0, _classCallCheck3.default)(this, PrettyFormatter);
    return (0, _possibleConstructorReturn3.default)(this, (PrettyFormatter.__proto__ || Object.getPrototypeOf(PrettyFormatter)).apply(this, arguments));
  }

  (0, _createClass3.default)(PrettyFormatter, [{
    key: 'applyColor',
    value: function applyColor(stepResult, text) {
      var status = stepResult.status;
      return this.colorFns[status](text);
    }
  }, {
    key: 'formatDataTable',
    value: function formatDataTable(dataTable) {
      var rows = dataTable.raw().map(function (row) {
        return row.map(function (cell) {
          return cell.replace(/\\/g, '\\\\').replace(/\n/g, '\\n');
        });
      });
      var table = new _cliTable2.default({
        chars: {
          bottom: '',
          'bottom-left': '',
          'bottom-mid': '',
          'bottom-right': '',
          left: '|',
          'left-mid': '',
          mid: '',
          'mid-mid': '',
          middle: '|',
          right: '|',
          'right-mid': '',
          top: '',
          'top-left': '',
          'top-mid': '',
          'top-right': ''
        },
        style: {
          border: [],
          'padding-left': 1,
          'padding-right': 1
        }
      });
      table.push.apply(table, rows);
      return table.toString();
    }
  }, {
    key: 'formatDocString',
    value: function formatDocString(docString) {
      return '"""\n' + docString.content + '\n"""';
    }
  }, {
    key: 'formatTags',
    value: function formatTags(tags) {
      if (tags.length === 0) {
        return '';
      }
      var tagNames = tags.map(function (tag) {
        return tag.name;
      });
      return this.colorFns.tag(tagNames.join(' '));
    }
  }, {
    key: 'handleAfterScenario',
    value: function handleAfterScenario() {
      this.log('\n');
    }
  }, {
    key: 'handleBeforeFeature',
    value: function handleBeforeFeature(feature) {
      var text = '';
      var tagsText = this.formatTags(feature.tags);
      if (tagsText) {
        text = tagsText + '\n';
      }
      text += feature.keyword + ': ' + feature.name;
      var description = feature.description;
      if (description) {
        text += '\n\n' + (0, _indentString2.default)(description, 2);
      }
      this.log(text + '\n\n');
    }
  }, {
    key: 'handleBeforeScenario',
    value: function handleBeforeScenario(scenario) {
      var text = '';
      var tagsText = this.formatTags(scenario.tags);
      if (tagsText) {
        text = tagsText + '\n';
      }
      text += scenario.keyword + ': ' + scenario.name;
      this.logIndented(text + '\n', 1);
    }
  }, {
    key: 'handleStepResult',
    value: function handleStepResult(stepResult) {
      if (!(stepResult.step instanceof _hook2.default)) {
        this.logStepResult(stepResult);
      }
    }
  }, {
    key: 'logIndented',
    value: function logIndented(text, level) {
      this.log((0, _indentString2.default)(text, level * 2));
    }
  }, {
    key: 'logStepResult',
    value: function logStepResult(stepResult) {
      var _this2 = this;

      var status = stepResult.status,
          step = stepResult.step;

      var colorFn = this.colorFns[status];

      var symbol = PrettyFormatter.CHARACTERS[stepResult.status];
      var identifier = colorFn(symbol + ' ' + step.keyword + (step.name || ''));
      this.logIndented(identifier + '\n', 1);

      step.arguments.forEach(function (arg) {
        var str = void 0;
        if (arg instanceof _data_table2.default) {
          str = _this2.formatDataTable(arg);
        } else if (arg instanceof _doc_string2.default) {
          str = _this2.formatDocString(arg);
        } else {
          throw new Error('Unknown argument type: ' + arg);
        }
        _this2.logIndented(colorFn(str) + '\n', 3);
      });
    }
  }]);
  return PrettyFormatter;
}(_summary_formatter2.default);

exports.default = PrettyFormatter;


PrettyFormatter.CHARACTERS = (_PrettyFormatter$CHAR = {}, (0, _defineProperty3.default)(_PrettyFormatter$CHAR, _status2.default.AMBIGUOUS, _figures2.default.cross), (0, _defineProperty3.default)(_PrettyFormatter$CHAR, _status2.default.FAILED, _figures2.default.cross), (0, _defineProperty3.default)(_PrettyFormatter$CHAR, _status2.default.PASSED, _figures2.default.tick), (0, _defineProperty3.default)(_PrettyFormatter$CHAR, _status2.default.PENDING, '?'), (0, _defineProperty3.default)(_PrettyFormatter$CHAR, _status2.default.SKIPPED, '-'), (0, _defineProperty3.default)(_PrettyFormatter$CHAR, _status2.default.UNDEFINED, '?'), _PrettyFormatter$CHAR);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mb3JtYXR0ZXIvcHJldHR5X2Zvcm1hdHRlci5qcyJdLCJuYW1lcyI6WyJQcmV0dHlGb3JtYXR0ZXIiLCJzdGVwUmVzdWx0IiwidGV4dCIsInN0YXR1cyIsImNvbG9yRm5zIiwiZGF0YVRhYmxlIiwicm93cyIsInJhdyIsIm1hcCIsInJvdyIsImNlbGwiLCJyZXBsYWNlIiwidGFibGUiLCJjaGFycyIsImJvdHRvbSIsImxlZnQiLCJtaWQiLCJtaWRkbGUiLCJyaWdodCIsInRvcCIsInN0eWxlIiwiYm9yZGVyIiwicHVzaCIsImFwcGx5IiwidG9TdHJpbmciLCJkb2NTdHJpbmciLCJjb250ZW50IiwidGFncyIsImxlbmd0aCIsInRhZ05hbWVzIiwidGFnIiwibmFtZSIsImpvaW4iLCJsb2ciLCJmZWF0dXJlIiwidGFnc1RleHQiLCJmb3JtYXRUYWdzIiwia2V5d29yZCIsImRlc2NyaXB0aW9uIiwic2NlbmFyaW8iLCJsb2dJbmRlbnRlZCIsInN0ZXAiLCJsb2dTdGVwUmVzdWx0IiwibGV2ZWwiLCJjb2xvckZuIiwic3ltYm9sIiwiQ0hBUkFDVEVSUyIsImlkZW50aWZpZXIiLCJhcmd1bWVudHMiLCJmb3JFYWNoIiwic3RyIiwiYXJnIiwiZm9ybWF0RGF0YVRhYmxlIiwiZm9ybWF0RG9jU3RyaW5nIiwiRXJyb3IiLCJBTUJJR1VPVVMiLCJjcm9zcyIsIkZBSUxFRCIsIlBBU1NFRCIsInRpY2siLCJQRU5ESU5HIiwiU0tJUFBFRCIsIlVOREVGSU5FRCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7OztJQUVxQkEsZTs7Ozs7Ozs7OzsrQkFDUkMsVSxFQUFZQyxJLEVBQU07QUFDM0IsVUFBTUMsU0FBU0YsV0FBV0UsTUFBMUI7QUFDQSxhQUFPLEtBQUtDLFFBQUwsQ0FBY0QsTUFBZCxFQUFzQkQsSUFB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Qix3REFNRyxpQkFBT0MsU0FOVixFQU1zQixHQU50QiIsImZpbGUiOiJwcmV0dHlfZm9ybWF0dGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IERhdGFUYWJsZSBmcm9tICcuLi9tb2RlbHMvc3RlcF9hcmd1bWVudHMvZGF0YV90YWJsZSdcbmltcG9ydCBEb2NTdHJpbmcgZnJvbSAnLi4vbW9kZWxzL3N0ZXBfYXJndW1lbnRzL2RvY19zdHJpbmcnXG5pbXBvcnQgZmlndXJlcyBmcm9tICdmaWd1cmVzJ1xuaW1wb3J0IEhvb2sgZnJvbSAnLi4vbW9kZWxzL2hvb2snXG5pbXBvcnQgU3RhdHVzIGZyb20gJy4uL3N0YXR1cydcbmltcG9ydCBTdW1tYXJ5Rm9ybWF0dGVyIGZyb20gJy4vc3VtbWFyeV9mb3JtYXR0ZXInXG5pbXBvcnQgVGFibGUgZnJvbSAnY2xpLXRhYmxlJ1xuaW1wb3J0IGluZGVudFN0cmluZyBmcm9tICdpbmRlbnQtc3RyaW5nJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQcmV0dHlGb3JtYXR0ZXIgZXh0ZW5kcyBTdW1tYXJ5Rm9ybWF0dGVyIHtcbiAgYXBwbHlDb2xvcihzdGVwUmVzdWx0LCB0ZXh0KSB7XG4gICAgY29uc3Qgc3RhdHVzID0gc3RlcFJlc3VsdC5zdGF0dXNcbiAgICByZXR1cm4gdGhpcy5jb2xvckZuc1tzdGF0dXNdKHRleHQpXG4gIH1cblxuICBmb3JtYXREYXRhVGFibGUoZGF0YVRhYmxlKSB7XG4gICAgY29uc3Qgcm93cyA9IGRhdGFUYWJsZS5yYXcoKS5tYXAocm93ID0+IHtcbiAgICAgIHJldHVybiByb3cubWFwKGNlbGwgPT4ge1xuICAgICAgICByZXR1cm4gY2VsbC5yZXBsYWNlKC9cXFxcL2csICdcXFxcXFxcXCcpLnJlcGxhY2UoL1xcbi9nLCAnXFxcXG4nKVxuICAgICAgfSlcbiAgICB9KVxuICAgIGNvbnN0IHRhYmxlID0gbmV3IFRhYmxlKHtcbiAgICAgIGNoYXJzOiB7XG4gICAgICAgIGJvdHRvbTogJycsXG4gICAgICAgICdib3R0b20tbGVmdCc6ICcnLFxuICAgICAgICAnYm90dG9tLW1pZCc6ICcnLFxuICAgICAgICAnYm90dG9tLXJpZ2h0JzogJycsXG4gICAgICAgIGxlZnQ6ICd8JyxcbiAgICAgICAgJ2xlZnQtbWlkJzogJycsXG4gICAgICAgIG1pZDogJycsXG4gICAgICAgICdtaWQtbWlkJzogJycsXG4gICAgICAgIG1pZGRsZTogJ3wnLFxuICAgICAgICByaWdodDogJ3wnLFxuICAgICAgICAncmlnaHQtbWlkJzogJycsXG4gICAgICAgIHRvcDogJycsXG4gICAgICAgICd0b3AtbGVmdCc6ICcnLFxuICAgICAgICAndG9wLW1pZCc6ICcnLFxuICAgICAgICAndG9wLXJpZ2h0JzogJydcbiAgICAgIH0sXG4gICAgICBzdHlsZToge1xuICAgICAgICBib3JkZXI6IFtdLFxuICAgICAgICAncGFkZGluZy1sZWZ0JzogMSxcbiAgICAgICAgJ3BhZGRpbmctcmlnaHQnOiAxXG4gICAgICB9XG4gICAgfSlcbiAgICB0YWJsZS5wdXNoLmFwcGx5KHRhYmxlLCByb3dzKVxuICAgIHJldHVybiB0YWJsZS50b1N0cmluZygpXG4gIH1cblxuICBmb3JtYXREb2NTdHJpbmcoZG9jU3RyaW5nKSB7XG4gICAgcmV0dXJuICdcIlwiXCJcXG4nICsgZG9jU3RyaW5nLmNvbnRlbnQgKyAnXFxuXCJcIlwiJ1xuICB9XG5cbiAgZm9ybWF0VGFncyh0YWdzKSB7XG4gICAgaWYgKHRhZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gJydcbiAgICB9XG4gICAgY29uc3QgdGFnTmFtZXMgPSB0YWdzLm1hcCh0YWcgPT4gdGFnLm5hbWUpXG4gICAgcmV0dXJuIHRoaXMuY29sb3JGbnMudGFnKHRhZ05hbWVzLmpvaW4oJyAnKSlcbiAgfVxuXG4gIGhhbmRsZUFmdGVyU2NlbmFyaW8oKSB7XG4gICAgdGhpcy5sb2coJ1xcbicpXG4gIH1cblxuICBoYW5kbGVCZWZvcmVGZWF0dXJlKGZlYXR1cmUpIHtcbiAgICBsZXQgdGV4dCA9ICcnXG4gICAgbGV0IHRhZ3NUZXh0ID0gdGhpcy5mb3JtYXRUYWdzKGZlYXR1cmUudGFncylcbiAgICBpZiAodGFnc1RleHQpIHtcbiAgICAgIHRleHQgPSB0YWdzVGV4dCArICdcXG4nXG4gICAgfVxuICAgIHRleHQgKz0gZmVhdHVyZS5rZXl3b3JkICsgJzogJyArIGZlYXR1cmUubmFtZVxuICAgIGxldCBkZXNjcmlwdGlvbiA9IGZlYXR1cmUuZGVzY3JpcHRpb25cbiAgICBpZiAoZGVzY3JpcHRpb24pIHtcbiAgICAgIHRleHQgKz0gJ1xcblxcbicgKyBpbmRlbnRTdHJpbmcoZGVzY3JpcHRpb24sIDIpXG4gICAgfVxuICAgIHRoaXMubG9nKHRleHQgKyAnXFxuXFxuJylcbiAgfVxuXG4gIGhhbmRsZUJlZm9yZVNjZW5hcmlvKHNjZW5hcmlvKSB7XG4gICAgbGV0IHRleHQgPSAnJ1xuICAgIGxldCB0YWdzVGV4dCA9IHRoaXMuZm9ybWF0VGFncyhzY2VuYXJpby50YWdzKVxuICAgIGlmICh0YWdzVGV4dCkge1xuICAgICAgdGV4dCA9IHRhZ3NUZXh0ICsgJ1xcbidcbiAgICB9XG4gICAgdGV4dCArPSBzY2VuYXJpby5rZXl3b3JkICsgJzogJyArIHNjZW5hcmlvLm5hbWVcbiAgICB0aGlzLmxvZ0luZGVudGVkKHRleHQgKyAnXFxuJywgMSlcbiAgfVxuXG4gIGhhbmRsZVN0ZXBSZXN1bHQoc3RlcFJlc3VsdCkge1xuICAgIGlmICghKHN0ZXBSZXN1bHQuc3RlcCBpbnN0YW5jZW9mIEhvb2spKSB7XG4gICAgICB0aGlzLmxvZ1N0ZXBSZXN1bHQoc3RlcFJlc3VsdClcbiAgICB9XG4gIH1cblxuICBsb2dJbmRlbnRlZCh0ZXh0LCBsZXZlbCkge1xuICAgIHRoaXMubG9nKGluZGVudFN0cmluZyh0ZXh0LCBsZXZlbCAqIDIpKVxuICB9XG5cbiAgbG9nU3RlcFJlc3VsdChzdGVwUmVzdWx0KSB7XG4gICAgY29uc3QgeyBzdGF0dXMsIHN0ZXAgfSA9IHN0ZXBSZXN1bHRcbiAgICBjb25zdCBjb2xvckZuID0gdGhpcy5jb2xvckZuc1tzdGF0dXNdXG5cbiAgICBjb25zdCBzeW1ib2wgPSBQcmV0dHlGb3JtYXR0ZXIuQ0hBUkFDVEVSU1tzdGVwUmVzdWx0LnN0YXR1c11cbiAgICBjb25zdCBpZGVudGlmaWVyID0gY29sb3JGbihzeW1ib2wgKyAnICcgKyBzdGVwLmtleXdvcmQgKyAoc3RlcC5uYW1lIHx8ICcnKSlcbiAgICB0aGlzLmxvZ0luZGVudGVkKGlkZW50aWZpZXIgKyAnXFxuJywgMSlcblxuICAgIHN0ZXAuYXJndW1lbnRzLmZvckVhY2goYXJnID0+IHtcbiAgICAgIGxldCBzdHJcbiAgICAgIGlmIChhcmcgaW5zdGFuY2VvZiBEYXRhVGFibGUpIHtcbiAgICAgICAgc3RyID0gdGhpcy5mb3JtYXREYXRhVGFibGUoYXJnKVxuICAgICAgfSBlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBEb2NTdHJpbmcpIHtcbiAgICAgICAgc3RyID0gdGhpcy5mb3JtYXREb2NTdHJpbmcoYXJnKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGFyZ3VtZW50IHR5cGU6ICcgKyBhcmcpXG4gICAgICB9XG4gICAgICB0aGlzLmxvZ0luZGVudGVkKGNvbG9yRm4oc3RyKSArICdcXG4nLCAzKVxuICAgIH0pXG4gIH1cbn1cblxuUHJldHR5Rm9ybWF0dGVyLkNIQVJBQ1RFUlMgPSB7XG4gIFtTdGF0dXMuQU1CSUdVT1VTXTogZmlndXJlcy5jcm9zcyxcbiAgW1N0YXR1cy5GQUlMRURdOiBmaWd1cmVzLmNyb3NzLFxuICBbU3RhdHVzLlBBU1NFRF06IGZpZ3VyZXMudGljayxcbiAgW1N0YXR1cy5QRU5ESU5HXTogJz8nLFxuICBbU3RhdHVzLlNLSVBQRURdOiAnLScsXG4gIFtTdGF0dXMuVU5ERUZJTkVEXTogJz8nXG59XG4iXX0=