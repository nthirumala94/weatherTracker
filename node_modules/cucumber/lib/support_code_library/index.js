'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SupportCodeLibraryBuilder = undefined;

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _parameter_type_registry_builder = require('./parameter_type_registry_builder');

var _parameter_type_registry_builder2 = _interopRequireDefault(_parameter_type_registry_builder);

var _define_helpers = require('./define_helpers');

var _finalize_helpers = require('./finalize_helpers');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var SupportCodeLibraryBuilder = exports.SupportCodeLibraryBuilder = function () {
  function SupportCodeLibraryBuilder() {
    var _this = this;

    (0, _classCallCheck3.default)(this, SupportCodeLibraryBuilder);

    this.methods = {
      addTransform: (0, _define_helpers.addTransform)(this),
      defineParameterType: (0, _define_helpers.defineParameterType)(this),
      After: (0, _define_helpers.defineScenarioHook)(this, 'afterScenarioHookDefinitions'),
      AfterAll: (0, _define_helpers.defineFeaturesHook)(this, 'afterFeaturesHookDefinitions'),
      Before: (0, _define_helpers.defineScenarioHook)(this, 'beforeScenarioHookDefinitions'),
      BeforeAll: (0, _define_helpers.defineFeaturesHook)(this, 'beforeFeaturesHookDefinitions'),
      defineSupportCode: function defineSupportCode(fn) {
        fn(_this.methods());
      },
      defineStep: (0, _define_helpers.defineStep)(this),
      registerHandler: (0, _define_helpers.registerHandler)(this),
      registerListener: function registerListener(listener) {
        _this.options.listeners.push(listener);
      },
      setDefaultTimeout: function setDefaultTimeout(milliseconds) {
        _this.options.defaultTimeout = milliseconds;
      },
      setDefinitionFunctionWrapper: function setDefinitionFunctionWrapper(fn) {
        _this.options.definitionFunctionWrapper = fn;
      },
      setWorldConstructor: function setWorldConstructor(fn) {
        _this.options.World = fn;
      }
    };
    this.methods.Given = this.methods.When = this.methods.Then = this.methods.defineStep;
  }

  (0, _createClass3.default)(SupportCodeLibraryBuilder, [{
    key: 'finalize',
    value: function finalize() {
      var _this2 = this;

      (0, _finalize_helpers.wrapDefinitions)({
        cwd: this.cwd,
        definitionFunctionWrapper: this.definitionFunctionWrapper,
        definitions: _lodash2.default.chain(['afterFeaturesHook', 'afterScenarioHook', 'beforeFeaturesHook', 'beforeScenarioHook', 'step']).map(function (key) {
          return _this2.options[key + 'Definitions'];
        }).flatten().value()
      });
      this.options.afterScenarioHookDefinitions.reverse();
      this.options.afterFeaturesHookDefinitions.reverse();
      return this.options;
    }
  }, {
    key: 'reset',
    value: function reset(cwd) {
      this.cwd = cwd;
      this.options = _lodash2.default.cloneDeep({
        afterFeaturesHookDefinitions: [],
        afterScenarioHookDefinitions: [],
        beforeFeaturesHookDefinitions: [],
        beforeScenarioHookDefinitions: [],
        defaultTimeout: 5000,
        definitionFunctionWrapper: null,
        listeners: [],
        stepDefinitions: [],
        parameterTypeRegistry: _parameter_type_registry_builder2.default.build(),
        World: function World(_ref) {
          var attach = _ref.attach,
              parameters = _ref.parameters;

          this.attach = attach;
          this.parameters = parameters;
        }
      });
    }
  }]);
  return SupportCodeLibraryBuilder;
}();

exports.default = new SupportCodeLibraryBuilder();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdXBwb3J0X2NvZGVfbGlicmFyeS9pbmRleC5qcyJdLCJuYW1lcyI6WyJTdXBwb3J0Q29kZUxpYnJhcnlCdWlsZGVyIiwibWV0aG9kcyIsImFkZFRyYW5zZm9ybSIsImRlZmluZVBhcmFtZXRlclR5cGUiLCJBZnRlciIsIkFmdGVyQWxsIiwiQmVmb3JlIiwiQmVmb3JlQWxsIiwiZGVmaW5lU3VwcG9ydENvZGUiLCJmbiIsImRlZmluZVN0ZXAiLCJyZWdpc3RlckhhbmRsZXIiLCJyZWdpc3Rlckxpc3RlbmVyIiwib3B0aW9ucyIsImxpc3RlbmVycyIsInB1c2giLCJsaXN0ZW5lciIsInNldERlZmF1bHRUaW1lb3V0IiwiZGVmYXVsdFRpbWVvdXQiLCJtaWxsaXNlY29uZHMiLCJzZXREZWZpbml0aW9uRnVuY3Rpb25XcmFwcGVyIiwiZGVmaW5pdGlvbkZ1bmN0aW9uV3JhcHBlciIsInNldFdvcmxkQ29uc3RydWN0b3IiLCJXb3JsZCIsIkdpdmVuIiwiV2hlbiIsIlRoZW4iLCJjd2QiLCJkZWZpbml0aW9ucyIsImNoYWluIiwibWFwIiwia2V5IiwiZmxhdHRlbiIsInZhbHVlIiwiYWZ0ZXJTY2VuYXJpb0hvb2tEZWZpbml0aW9ucyIsInJldmVyc2UiLCJhZnRlckZlYXR1cmVzSG9va0RlZmluaXRpb25zIiwiY2xvbmVEZWVwIiwiYmVmb3JlRmVhdHVyZXNIb29rRGVmaW5pdGlvbnMiLCJiZWZvcmVTY2VuYXJpb0hvb2tEZWZpbml0aW9ucyIsInN0ZXBEZWZpbml0aW9ucyIsInBhcmFtZXRlclR5cGVSZWdpc3RyeSIsImJ1aWxkIiwiYXR0YWNoIiwicGFyYW1ldGVycyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7QUFDQTs7OztBQUNBOztBQVFBOzs7O0lBRWFBLHlCLFdBQUFBLHlCO0FBQ1gsdUNBQWM7QUFBQTs7QUFBQTs7QUFDWixTQUFLQyxPQUFMLEdBQWU7QUFDYkMsb0JBQWMsa0NBQWEsSUFBYixDQUREO0FBRWJDLDJCQUFxQix5Q0FBb0IsSUFBcEIsQ0FGUjtBQUdiQyxhQUFPLHdDQUFtQixJQUFuQixFQUF5Qiw4QkFBekIsQ0FITTtBQUliQyxnQkFBVSx3Q0FBbUIsSUFBbkIsRUFBeUIsOEJBQXpCLENBSkc7QUFLYkMsY0FBUSx3Q0FBbUIsSUFBbkIsRUFBeUIsK0JBQXpCLENBTEs7QUFNYkMsaUJBQVcsd0NBQW1CLElBQW5CLEVBQXlCLCtCQUF6QixDQU5FO0FBT2JDLHlCQUFtQiwrQkFBTTtBQUN2QkMsV0FBRyxNQUFLUixPQUFMLEVBQUg7QUFDRCxPQVRZO0FBVWJTLGtCQUFZLGdDQUFXLElBQVgsQ0FWQztBQVdiQyx1QkFBaUIscUNBQWdCLElBQWhCLENBWEo7QUFZYkMsd0JBQWtCLG9DQUFZO0FBQzVCLGNBQUtDLE9BQUwsQ0FBYUMsU0FBYixDQUF1QkMsSUFBdkIsQ0FBNEJDLFFBQTVCO0FBQ0QsT0FkWTtBQWViQyx5QkFBbUIseUNBQWdCO0FBQ2pDLGNBQUtKLE9BQUwsQ0FBYUssY0FBYixHQUE4QkMsWUFBOUI7QUFDRCxPQWpCWTtBQWtCYkMsb0NBQThCLDBDQUFNO0FBQ2xDLGNBQUtQLE9BQUwsQ0FBYVEseUJBQWIsR0FBeUNaLEVBQXpDO0FBQ0QsT0FwQlk7QUFxQmJhLDJCQUFxQixpQ0FBTTtBQUN6QixjQUFLVCxPQUFMLENBQWFVLEtBQWIsR0FBcUJkLEVBQXJCO0FBQ0Q7QUF2QlksS0FBZjtBQXlCQSxTQUFLUixPQUFMLENBQWF1QixLQUFiLEdBQXFCLEtBQUt2QixPQUFMLENBQWF3QixJQUFiLEdBQW9CLEtBQUt4QixPQUFMLENBQWF5QixJQUFiLEdBQW9CLEtBQUt6QixPQUFMLENBQWFTLFVBQTFFO0FBQ0Q7Ozs7K0JBRVU7QUFBQTs7QUFDVCw2Q0FBZ0I7QUFDZGlCLGFBQUssS0FBS0EsR0FESTtBQUVkTixtQ0FBMkIsS0FBS0EseUJBRmxCO0FBR2RPLHFCQUFhLGlCQUFFQyxLQUFGLENBQVEsQ0FDbkIsbUJBRG1CLEVBRW5CLG1CQUZtQixFQUduQixvQkFIbUIsRUFJbkIsb0JBSm1CLEVBS25CLE1BTG1CLENBQVIsRUFPVkMsR0FQVSxDQU9OO0FBQUEsaUJBQU8sT0FBS2pCLE9BQUwsQ0FBYWtCLE1BQU0sYUFBbkIsQ0FBUDtBQUFBLFNBUE0sRUFRVkMsT0FSVSxHQVNWQyxLQVRVO0FBSEMsT0FBaEI7QUFjQSxXQUFLcEIsT0FBTCxDQUFhcUIsNEJBQWIsQ0FBMENDLE9BQTFDO0FBQ0EsV0FBS3RCLE9BQUwsQ0FBYXVCLDRCQUFiLENBQTBDRCxPQUExQztBQUNBLGFBQU8sS0FBS3RCLE9BQVo7QUFDRDs7OzBCQUVLYyxHLEVBQUs7QUFDVCxXQUFLQSxHQUFMLEdBQVdBLEdBQVg7QUFDQSxXQUFLZCxPQUFMLEdBQWUsaUJBQUV3QixTQUFGLENBQVk7QUFDekJELHNDQUE4QixFQURMO0FBRXpCRixzQ0FBOEIsRUFGTDtBQUd6QkksdUNBQStCLEVBSE47QUFJekJDLHVDQUErQixFQUpOO0FBS3pCckIsd0JBQWdCLElBTFM7QUFNekJHLG1DQUEyQixJQU5GO0FBT3pCUCxtQkFBVyxFQVBjO0FBUXpCMEIseUJBQWlCLEVBUlE7QUFTekJDLCtCQUF1QiwwQ0FBdUJDLEtBQXZCLEVBVEU7QUFVekJuQixhQVZ5Qix1QkFVSztBQUFBLGNBQXRCb0IsTUFBc0IsUUFBdEJBLE1BQXNCO0FBQUEsY0FBZEMsVUFBYyxRQUFkQSxVQUFjOztBQUM1QixlQUFLRCxNQUFMLEdBQWNBLE1BQWQ7QUFDQSxlQUFLQyxVQUFMLEdBQWtCQSxVQUFsQjtBQUNEO0FBYndCLE9BQVosQ0FBZjtBQWVEOzs7OztrQkFHWSxJQUFJNUMseUJBQUosRSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCdcbmltcG9ydCBUcmFuc2Zvcm1Mb29rdXBCdWlsZGVyIGZyb20gJy4vcGFyYW1ldGVyX3R5cGVfcmVnaXN0cnlfYnVpbGRlcidcbmltcG9ydCB7XG4gIGFkZFRyYW5zZm9ybSxcbiAgZGVmaW5lRmVhdHVyZXNIb29rLFxuICBkZWZpbmVQYXJhbWV0ZXJUeXBlLFxuICBkZWZpbmVTY2VuYXJpb0hvb2ssXG4gIGRlZmluZVN0ZXAsXG4gIHJlZ2lzdGVySGFuZGxlclxufSBmcm9tICcuL2RlZmluZV9oZWxwZXJzJ1xuaW1wb3J0IHsgd3JhcERlZmluaXRpb25zIH0gZnJvbSAnLi9maW5hbGl6ZV9oZWxwZXJzJ1xuXG5leHBvcnQgY2xhc3MgU3VwcG9ydENvZGVMaWJyYXJ5QnVpbGRlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMubWV0aG9kcyA9IHtcbiAgICAgIGFkZFRyYW5zZm9ybTogYWRkVHJhbnNmb3JtKHRoaXMpLFxuICAgICAgZGVmaW5lUGFyYW1ldGVyVHlwZTogZGVmaW5lUGFyYW1ldGVyVHlwZSh0aGlzKSxcbiAgICAgIEFmdGVyOiBkZWZpbmVTY2VuYXJpb0hvb2sodGhpcywgJ2FmdGVyU2NlbmFyaW9Ib29rRGVmaW5pdGlvbnMnKSxcbiAgICAgIEFmdGVyQWxsOiBkZWZpbmVGZWF0dXJlc0hvb2sodGhpcywgJ2FmdGVyRmVhdHVyZXNIb29rRGVmaW5pdGlvbnMnKSxcbiAgICAgIEJlZm9yZTogZGVmaW5lU2NlbmFyaW9Ib29rKHRoaXMsICdiZWZvcmVTY2VuYXJpb0hvb2tEZWZpbml0aW9ucycpLFxuICAgICAgQmVmb3JlQWxsOiBkZWZpbmVGZWF0dXJlc0hvb2sodGhpcywgJ2JlZm9yZUZlYXR1cmVzSG9va0RlZmluaXRpb25zJyksXG4gICAgICBkZWZpbmVTdXBwb3J0Q29kZTogZm4gPT4ge1xuICAgICAgICBmbih0aGlzLm1ldGhvZHMoKSlcbiAgICAgIH0sXG4gICAgICBkZWZpbmVTdGVwOiBkZWZpbmVTdGVwKHRoaXMpLFxuICAgICAgcmVnaXN0ZXJIYW5kbGVyOiByZWdpc3RlckhhbmRsZXIodGhpcyksXG4gICAgICByZWdpc3Rlckxpc3RlbmVyOiBsaXN0ZW5lciA9PiB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5saXN0ZW5lcnMucHVzaChsaXN0ZW5lcilcbiAgICAgIH0sXG4gICAgICBzZXREZWZhdWx0VGltZW91dDogbWlsbGlzZWNvbmRzID0+IHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmRlZmF1bHRUaW1lb3V0ID0gbWlsbGlzZWNvbmRzXG4gICAgICB9LFxuICAgICAgc2V0RGVmaW5pdGlvbkZ1bmN0aW9uV3JhcHBlcjogZm4gPT4ge1xuICAgICAgICB0aGlzLm9wdGlvbnMuZGVmaW5pdGlvbkZ1bmN0aW9uV3JhcHBlciA9IGZuXG4gICAgICB9LFxuICAgICAgc2V0V29ybGRDb25zdHJ1Y3RvcjogZm4gPT4ge1xuICAgICAgICB0aGlzLm9wdGlvbnMuV29ybGQgPSBmblxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLm1ldGhvZHMuR2l2ZW4gPSB0aGlzLm1ldGhvZHMuV2hlbiA9IHRoaXMubWV0aG9kcy5UaGVuID0gdGhpcy5tZXRob2RzLmRlZmluZVN0ZXBcbiAgfVxuXG4gIGZpbmFsaXplKCkge1xuICAgIHdyYXBEZWZpbml0aW9ucyh7XG4gICAgICBjd2Q6IHRoaXMuY3dkLFxuICAgICAgZGVmaW5pdGlvbkZ1bmN0aW9uV3JhcHBlcjogdGhpcy5kZWZpbml0aW9uRnVuY3Rpb25XcmFwcGVyLFxuICAgICAgZGVmaW5pdGlvbnM6IF8uY2hhaW4oW1xuICAgICAgICAnYWZ0ZXJGZWF0dXJlc0hvb2snLFxuICAgICAgICAnYWZ0ZXJTY2VuYXJpb0hvb2snLFxuICAgICAgICAnYmVmb3JlRmVhdHVyZXNIb29rJyxcbiAgICAgICAgJ2JlZm9yZVNjZW5hcmlvSG9vaycsXG4gICAgICAgICdzdGVwJ1xuICAgICAgXSlcbiAgICAgICAgLm1hcChrZXkgPT4gdGhpcy5vcHRpb25zW2tleSArICdEZWZpbml0aW9ucyddKVxuICAgICAgICAuZmxhdHRlbigpXG4gICAgICAgIC52YWx1ZSgpXG4gICAgfSlcbiAgICB0aGlzLm9wdGlvbnMuYWZ0ZXJTY2VuYXJpb0hvb2tEZWZpbml0aW9ucy5yZXZlcnNlKClcbiAgICB0aGlzLm9wdGlvbnMuYWZ0ZXJGZWF0dXJlc0hvb2tEZWZpbml0aW9ucy5yZXZlcnNlKClcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zXG4gIH1cblxuICByZXNldChjd2QpIHtcbiAgICB0aGlzLmN3ZCA9IGN3ZFxuICAgIHRoaXMub3B0aW9ucyA9IF8uY2xvbmVEZWVwKHtcbiAgICAgIGFmdGVyRmVhdHVyZXNIb29rRGVmaW5pdGlvbnM6IFtdLFxuICAgICAgYWZ0ZXJTY2VuYXJpb0hvb2tEZWZpbml0aW9uczogW10sXG4gICAgICBiZWZvcmVGZWF0dXJlc0hvb2tEZWZpbml0aW9uczogW10sXG4gICAgICBiZWZvcmVTY2VuYXJpb0hvb2tEZWZpbml0aW9uczogW10sXG4gICAgICBkZWZhdWx0VGltZW91dDogNTAwMCxcbiAgICAgIGRlZmluaXRpb25GdW5jdGlvbldyYXBwZXI6IG51bGwsXG4gICAgICBsaXN0ZW5lcnM6IFtdLFxuICAgICAgc3RlcERlZmluaXRpb25zOiBbXSxcbiAgICAgIHBhcmFtZXRlclR5cGVSZWdpc3RyeTogVHJhbnNmb3JtTG9va3VwQnVpbGRlci5idWlsZCgpLFxuICAgICAgV29ybGQoeyBhdHRhY2gsIHBhcmFtZXRlcnMgfSkge1xuICAgICAgICB0aGlzLmF0dGFjaCA9IGF0dGFjaFxuICAgICAgICB0aGlzLnBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzXG4gICAgICB9XG4gICAgfSlcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBuZXcgU3VwcG9ydENvZGVMaWJyYXJ5QnVpbGRlcigpXG4iXX0=