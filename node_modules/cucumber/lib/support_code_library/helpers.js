'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.defineTestCaseHook = defineTestCaseHook;
exports.defineTestRunHook = defineTestRunHook;
exports.defineStep = defineStep;
exports.addTransform = addTransform;
exports.defineParameterType = defineParameterType;

var _util = require('util');

var _util2 = _interopRequireDefault(_util);

var _cucumberExpressions = require('cucumber-expressions');

var _helpers = require('../formatter/helpers');

var _test_case_hook_definition = require('../models/test_case_hook_definition');

var _test_case_hook_definition2 = _interopRequireDefault(_test_case_hook_definition);

var _test_run_hook_definition = require('../models/test_run_hook_definition');

var _test_run_hook_definition2 = _interopRequireDefault(_test_run_hook_definition);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _stacktraceJs = require('stacktrace-js');

var _stacktraceJs2 = _interopRequireDefault(_stacktraceJs);

var _step_definition = require('../models/step_definition');

var _step_definition2 = _interopRequireDefault(_step_definition);

var _validate_arguments = require('./validate_arguments');

var _validate_arguments2 = _interopRequireDefault(_validate_arguments);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function defineTestCaseHook(cwd, collection) {
  return function (options, code) {
    if (typeof options === 'string') {
      options = { tags: options };
    } else if (typeof options === 'function') {
      code = options;
      options = {};
    }

    var _getDefinitionLineAnd = getDefinitionLineAndUri(cwd),
        line = _getDefinitionLineAnd.line,
        uri = _getDefinitionLineAnd.uri;

    (0, _validate_arguments2.default)({
      args: { code: code, options: options },
      fnName: 'defineTestCaseHook',
      location: (0, _helpers.formatLocation)({ line: line, uri: uri })
    });
    var hookDefinition = new _test_case_hook_definition2.default({
      code: code,
      line: line,
      options: options,
      uri: uri
    });
    collection.push(hookDefinition);
  };
}

function defineTestRunHook(cwd, collection) {
  return function (options, code) {
    if (typeof options === 'string') {
      options = { tags: options };
    } else if (typeof options === 'function') {
      code = options;
      options = {};
    }

    var _getDefinitionLineAnd2 = getDefinitionLineAndUri(cwd),
        line = _getDefinitionLineAnd2.line,
        uri = _getDefinitionLineAnd2.uri;

    (0, _validate_arguments2.default)({
      args: { code: code, options: options },
      fnName: 'defineTestRunHook',
      location: (0, _helpers.formatLocation)({ line: line, uri: uri })
    });
    var hookDefinition = new _test_run_hook_definition2.default({
      code: code,
      line: line,
      options: options,
      uri: uri
    });
    collection.push(hookDefinition);
  };
}

function defineStep(cwd, collection) {
  return function (pattern, options, code) {
    if (typeof options === 'function') {
      code = options;
      options = {};
    }

    var _getDefinitionLineAnd3 = getDefinitionLineAndUri(cwd),
        line = _getDefinitionLineAnd3.line,
        uri = _getDefinitionLineAnd3.uri;

    (0, _validate_arguments2.default)({
      args: { code: code, pattern: pattern, options: options },
      fnName: 'defineStep',
      location: (0, _helpers.formatLocation)({ line: line, uri: uri })
    });
    var stepDefinition = new _step_definition2.default({
      code: code,
      line: line,
      options: options,
      pattern: pattern,
      uri: uri
    });
    collection.push(stepDefinition);
  };
}

function getDefinitionLineAndUri(cwd) {
  var stackframes = _stacktraceJs2.default.getSync();
  var stackframe = stackframes.length > 2 ? stackframes[2] : stackframes[0];
  var line = stackframe.getLineNumber();
  var uri = stackframe.getFileName();
  if (uri) {
    uri = _path2.default.relative(cwd, uri.replace(/\//g, _path2.default.sep));
  } else {
    uri = 'unknown';
  }
  return { line: line, uri: uri };
}

function addTransform(parameterTypeRegistry) {
  return _util2.default.deprecate(function (_ref) {
    var captureGroupRegexps = _ref.captureGroupRegexps,
        transformer = _ref.transformer,
        typeName = _ref.typeName;

    var parameter = new _cucumberExpressions.ParameterType(typeName, null, captureGroupRegexps, transformer);
    parameterTypeRegistry.defineParameterType(parameter);
  }, 'addTransform is deprecated and will be removed in a future version. Please use defineParameterType instead.');
}

function defineParameterType(parameterTypeRegistry) {
  return function (_ref2) {
    var regexp = _ref2.regexp,
        transformer = _ref2.transformer,
        typeName = _ref2.typeName;

    var parameter = new _cucumberExpressions.ParameterType(typeName, null, regexp, transformer);
    parameterTypeRegistry.defineParameterType(parameter);
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdXBwb3J0X2NvZGVfbGlicmFyeS9oZWxwZXJzLmpzIl0sIm5hbWVzIjpbImRlZmluZVRlc3RDYXNlSG9vayIsImRlZmluZVRlc3RSdW5Ib29rIiwiZGVmaW5lU3RlcCIsImFkZFRyYW5zZm9ybSIsImRlZmluZVBhcmFtZXRlclR5cGUiLCJjd2QiLCJjb2xsZWN0aW9uIiwib3B0aW9ucyIsImNvZGUiLCJ0YWdzIiwiZ2V0RGVmaW5pdGlvbkxpbmVBbmRVcmkiLCJsaW5lIiwidXJpIiwiYXJncyIsImZuTmFtZSIsImxvY2F0aW9uIiwiaG9va0RlZmluaXRpb24iLCJwdXNoIiwicGF0dGVybiIsInN0ZXBEZWZpbml0aW9uIiwic3RhY2tmcmFtZXMiLCJnZXRTeW5jIiwic3RhY2tmcmFtZSIsImxlbmd0aCIsImdldExpbmVOdW1iZXIiLCJnZXRGaWxlTmFtZSIsInJlbGF0aXZlIiwicmVwbGFjZSIsInNlcCIsInBhcmFtZXRlclR5cGVSZWdpc3RyeSIsImRlcHJlY2F0ZSIsImNhcHR1cmVHcm91cFJlZ2V4cHMiLCJ0cmFuc2Zvcm1lciIsInR5cGVOYW1lIiwicGFyYW1ldGVyIiwicmVnZXhwIl0sIm1hcHBpbmdzIjoiOzs7OztRQVVnQkEsa0IsR0FBQUEsa0I7UUF3QkFDLGlCLEdBQUFBLGlCO1FBd0JBQyxVLEdBQUFBLFU7UUFvQ0FDLFksR0FBQUEsWTtRQVlBQyxtQixHQUFBQSxtQjs7QUExR2hCOzs7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7QUFFTyxTQUFTSixrQkFBVCxDQUE0QkssR0FBNUIsRUFBaUNDLFVBQWpDLEVBQTZDO0FBQ2xELFNBQU8sVUFBQ0MsT0FBRCxFQUFVQyxJQUFWLEVBQW1CO0FBQ3hCLFFBQUksT0FBT0QsT0FBUCxLQUFtQixRQUF2QixFQUFpQztBQUMvQkEsZ0JBQVUsRUFBRUUsTUFBTUYsT0FBUixFQUFWO0FBQ0QsS0FGRCxNQUVPLElBQUks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QVgsRUFBYjtBQUNBLE1BQUlaLE1BQU1VLFdBQVdHLFdBQVgsRUFBVjtBQUNBLE1BQUliLEdBQUosRUFBUztBQUNQQSxVQUFNLGVBQUtjLFFBQUwsQ0FBY3JCLEdBQWQsRUFBbUJPLElBQUllLE9BQUosQ0FBWSxLQUFaLEVBQW1CLGVBQUtDLEdBQXhCLENBQW5CLENBQU47QUFDRCxHQUZELE1BRU87QUFDTGhCLFVBQU0sU0FBTjtBQUNEO0FBQ0QsU0FBTyxFQUFFRCxVQUFGLEVBQVFDLFFBQVIsRUFBUDtBQUNEOztBQUVNLFNBQVNULFlBQVQsQ0FBc0IwQixxQkFBdEIsRUFBNkM7QUFDbEQsU0FBTyxlQUFLQyxTQUFMLENBQWUsZ0JBQW9EO0FBQUEsUUFBakRDLG1CQUFpRCxRQUFqREEsbUJBQWlEO0FBQUEsUUFBNUJDLFdBQTRCLFFBQTVCQSxXQUE0QjtBQUFBLFFBQWZDLFFBQWUsUUFBZkEsUUFBZTs7QUFDeEUsUUFBTUMsWUFBWSx1Q0FDaEJELFFBRGdCLEVBRWhCLElBRmdCLEVBR2hCRixtQkFIZ0IsRUFJaEJDLFdBSmdCLENBQWxCO0FBTUFILDBCQUFzQnpCLG1CQUF0QixDQUEwQzhCLFNBQTFDO0FBQ0QsR0FSTSxFQVFKLDZHQVJJLENBQVA7QUFTRDs7QUFFTSxTQUFTOUIsbUJBQVQsQ0FBNkJ5QixxQkFBN0IsRUFBb0Q7QUFDekQsU0FBTyxpQkFBdUM7QUFBQSxRQUFwQ00sTUFBb0MsU0FBcENBLE1BQW9DO0FBQUEsUUFBNUJILFdBQTRCLFNBQTVCQSxXQUE0QjtBQUFBLFFBQWZDLFFBQWUsU0FBZkEsUUFBZTs7QUFDNUMsUUFBTUMsWUFBWSx1Q0FBa0JELFFBQWxCLEVBQTRCLElBQTVCLEVBQWtDRSxNQUFsQyxFQUEwQ0gsV0FBMUMsQ0FBbEI7QUFDQUgsMEJBQXNCekIsbUJBQXRCLENBQTBDOEIsU0FBMUM7QUFDRCxHQUhEO0FBSUQiLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB1dGlsIGZyb20gJ3V0aWwnXG5pbXBvcnQgeyBQYXJhbWV0ZXJUeXBlIH0gZnJvbSAnY3VjdW1iZXItZXhwcmVzc2lvbnMnXG5pbXBvcnQgeyBmb3JtYXRMb2NhdGlvbiB9IGZyb20gJy4uL2Zvcm1hdHRlci9oZWxwZXJzJ1xuaW1wb3J0IFRlc3RDYXNlSG9va0RlZmluaXRpb24gZnJvbSAnLi4vbW9kZWxzL3Rlc3RfY2FzZV9ob29rX2RlZmluaXRpb24nXG5pbXBvcnQgVGVzdFJ1bkhvb2tEZWZpbml0aW9uIGZyb20gJy4uL21vZGVscy90ZXN0X3J1bl9ob29rX2RlZmluaXRpb24nXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IFN0YWNrVHJhY2UgZnJvbSAnc3RhY2t0cmFjZS1qcydcbmltcG9ydCBTdGVwRGVmaW5pdGlvbiBmcm9tICcuLi9tb2RlbHMvc3RlcF9kZWZpbml0aW9uJ1xuaW1wb3J0IHZhbGlkYXRlQXJndW1lbnRzIGZyb20gJy4vdmFsaWRhdGVfYXJndW1lbnRzJ1xuXG5leHBvcnQgZnVuY3Rpb24gZGVmaW5lVGVzdENhc2VIb29rKGN3ZCwgY29sbGVjdGlvbikge1xuICByZXR1cm4gKG9wdGlvbnMsIGNvZGUpID0+IHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7XG4gICAgICBvcHRpb25zID0geyB0YWdzOiBvcHRpb25zIH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBjb2RlID0gb3B0aW9uc1xuICAgICAgb3B0aW9ucyA9IHt9XG4gICAgfVxuICAgIGNvbnN0IHsgbGluZSwgdXJpIH0gPSBnZXREZWZpbml0aW9uTGluZUFuZFVyaShjd2QpXG4gICAgdmFsaWRhdGVBcmd1bWVudHMoe1xuICAgICAgYXJnczogeyBjb2RlLCBvcHRpb25zIH0sXG4gICAgICBmbk5hbWU6ICdkZWZpbmVUZXN0Q2FzZUhvb2snLFxuICAgICAgbG9jYXRpb246IGZvcm1hdExvY2F0aW9uKHsgbGluZSwgdXJpIH0pXG4gICAgfSlcbiAgICBjb25zdCBob29rRGVmaW5pdGlvbiA9IG5ldyBUZXN0Q2FzZUhvb2tEZWZpbml0aW9uKHtcbiAgICAgIGNvZGUsXG4gICAgICBsaW5lLFxuICAgICAgb3B0aW9ucyxcbiAgICAgIHVyaVxuICAgIH0pXG4gICAgY29sbGVjdGlvbi5wdXNoKGhvb2tEZWZpbml0aW9uKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWZpbmVUZXN0UnVuSG9vayhjd2QsIGNvbGxlY3Rpb24pIHtcbiAgcmV0dXJuIChvcHRpb25zLCBjb2RlKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnc3RyaW5nJykge1xuICAgICAgb3B0aW9ucyA9IHsgdGFnczogb3B0aW9ucyB9XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY29kZSA9IG9wdGlvbnNcbiAgICAgIG9wdGlvbnMgPSB7fVxuICAgIH1cbiAgICBjb25zdCB7IGxpbmUsIHVyaSB9ID0gZ2V0RGVmaW5pdGlvbkxpbmVBbmRVcmkoY3dkKVxuICAgIHZhbGlkYXRlQXJndW1lbnRzKHtcbiAgICAgIGFyZ3M6IHsgY29kZSwgb3B0aW9ucyB9LFxuICAgICAgZm5OYW1lOiAnZGVmaW5lVGVzdFJ1bkhvb2snLFxuICAgICAgbG9jYXRpb246IGZvcm1hdExvY2F0aW9uKHsgbGluZSwgdXJpIH0pXG4gICAgfSlcbiAgICBjb25zdCBob29rRGVmaW5pdGlvbiA9IG5ldyBUZXN0UnVuSG9va0RlZmluaXRpb24oe1xuICAgICAgY29kZSxcbiAgICAgIGxpbmUsXG4gICAgICBvcHRpb25zLFxuICAgICAgdXJpXG4gICAgfSlcbiAgICBjb2xsZWN0aW9uLnB1c2goaG9va0RlZmluaXRpb24pXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlZmluZVN0ZXAoY3dkLCBjb2xsZWN0aW9uKSB7XG4gIHJldHVybiAocGF0dGVybiwgb3B0aW9ucywgY29kZSkgPT4ge1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY29kZSA9IG9wdGlvbnNcbiAgICAgIG9wdGlvbnMgPSB7fVxuICAgIH1cbiAgICBjb25zdCB7IGxpbmUsIHVyaSB9ID0gZ2V0RGVmaW5pdGlvbkxpbmVBbmRVcmkoY3dkKVxuICAgIHZhbGlkYXRlQXJndW1lbnRzKHtcbiAgICAgIGFyZ3M6IHsgY29kZSwgcGF0dGVybiwgb3B0aW9ucyB9LFxuICAgICAgZm5OYW1lOiAnZGVmaW5lU3RlcCcsXG4gICAgICBsb2NhdGlvbjogZm9ybWF0TG9jYXRpb24oeyBsaW5lLCB1cmkgfSlcbiAgICB9KVxuICAgIGNvbnN0IHN0ZXBEZWZpbml0aW9uID0gbmV3IFN0ZXBEZWZpbml0aW9uKHtcbiAgICAgIGNvZGUsXG4gICAgICBsaW5lLFxuICAgICAgb3B0aW9ucyxcbiAgICAgIHBhdHRlcm4sXG4gICAgICB1cmlcbiAgICB9KVxuICAgIGNvbGxlY3Rpb24ucHVzaChzdGVwRGVmaW5pdGlvbilcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXREZWZpbml0aW9uTGluZUFuZFVyaShjd2QpIHtcbiAgY29uc3Qgc3RhY2tmcmFtZXMgPSBTdGFja1RyYWNlLmdldFN5bmMoKVxuICBjb25zdCBzdGFja2ZyYW1lID0gc3RhY2tmcmFtZXMubGVuZ3RoID4gMiA/IHN0YWNrZnJhbWVzWzJdIDogc3RhY2tmcmFtZXNbMF1cbiAgY29uc3QgbGluZSA9IHN0YWNrZnJhbWUuZ2V0TGluZU51bWJlcigpXG4gIGxldCB1cmkgPSBzdGFja2ZyYW1lLmdldEZpbGVOYW1lKClcbiAgaWYgKHVyaSkge1xuICAgIHVyaSA9IHBhdGgucmVsYXRpdmUoY3dkLCB1cmkucmVwbGFjZSgvXFwvL2csIHBhdGguc2VwKSlcbiAgfSBlbHNlIHtcbiAgICB1cmkgPSAndW5rbm93bidcbiAgfVxuICByZXR1cm4geyBsaW5lLCB1cmkgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gYWRkVHJhbnNmb3JtKHBhcmFtZXRlclR5cGVSZWdpc3RyeSkge1xuICByZXR1cm4gdXRpbC5kZXByZWNhdGUoKHsgY2FwdHVyZUdyb3VwUmVnZXhwcywgdHJhbnNmb3JtZXIsIHR5cGVOYW1lIH0pID0+IHtcbiAgICBjb25zdCBwYXJhbWV0ZXIgPSBuZXcgUGFyYW1ldGVyVHlwZShcbiAgICAgIHR5cGVOYW1lLFxuICAgICAgbnVsbCxcbiAgICAgIGNhcHR1cmVHcm91cFJlZ2V4cHMsXG4gICAgICB0cmFuc2Zvcm1lclxuICAgIClcbiAgICBwYXJhbWV0ZXJUeXBlUmVnaXN0cnkuZGVmaW5lUGFyYW1ldGVyVHlwZShwYXJhbWV0ZXIpXG4gIH0sICdhZGRUcmFuc2Zvcm0gaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIHZlcnNpb24uIFBsZWFzZSB1c2UgZGVmaW5lUGFyYW1ldGVyVHlwZSBpbnN0ZWFkLicpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWZpbmVQYXJhbWV0ZXJUeXBlKHBhcmFtZXRlclR5cGVSZWdpc3RyeSkge1xuICByZXR1cm4gKHsgcmVnZXhwLCB0cmFuc2Zvcm1lciwgdHlwZU5hbWUgfSkgPT4ge1xuICAgIGNvbnN0IHBhcmFtZXRlciA9IG5ldyBQYXJhbWV0ZXJUeXBlKHR5cGVOYW1lLCBudWxsLCByZWdleHAsIHRyYW5zZm9ybWVyKVxuICAgIHBhcmFtZXRlclR5cGVSZWdpc3RyeS5kZWZpbmVQYXJhbWV0ZXJUeXBlKHBhcmFtZXRlcilcbiAgfVxufVxuIl19