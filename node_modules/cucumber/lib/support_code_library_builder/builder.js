'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _utilArity = require('util-arity');

var _utilArity2 = _interopRequireDefault(_utilArity);

var _isGenerator = require('is-generator');

var _isGenerator2 = _interopRequireDefault(_isGenerator);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _parameter_type_registry_builder = require('./parameter_type_registry_builder');

var _parameter_type_registry_builder2 = _interopRequireDefault(_parameter_type_registry_builder);

var _helpers = require('./helpers');

var helpers = _interopRequireWildcard(_helpers);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function build(_ref) {
  var cwd = _ref.cwd,
      fns = _ref.fns;

  var options = {
    afterFeaturesHookDefinitions: [],
    afterScenarioHookDefinitions: [],
    beforeFeaturesHookDefinitions: [],
    beforeScenarioHookDefinitions: [],
    defaultTimeout: 5000,
    listeners: [],
    stepDefinitions: [],
    parameterTypeRegistry: _parameter_type_registry_builder2.default.build(),
    World: function World(_ref2) {
      var attach = _ref2.attach,
          parameters = _ref2.parameters;

      this.attach = attach;
      this.parameters = parameters;
    }
  };
  var definitionFunctionWrapper = null;
  var fnArgument = {
    addTransform: helpers.addTransform(options.parameterTypeRegistry),
    defineParameterType: helpers.defineParameterType(options.parameterTypeRegistry),
    After: helpers.defineScenarioHook(cwd, options.afterScenarioHookDefinitions),
    AfterAll: helpers.defineFeaturesHook(cwd, options.afterFeaturesHookDefinitions),
    Before: helpers.defineScenarioHook(cwd, options.beforeScenarioHookDefinitions),
    BeforeAll: helpers.defineFeaturesHook(cwd, options.beforeFeaturesHookDefinitions),
    defineStep: helpers.defineStep(cwd, options.stepDefinitions),
    registerHandler: helpers.registerHandler(cwd, options.listeners),
    registerListener: function registerListener(listener) {
      options.listeners.push(listener);
    },
    setDefaultTimeout: function setDefaultTimeout(milliseconds) {
      options.defaultTimeout = milliseconds;
    },
    setDefinitionFunctionWrapper: function setDefinitionFunctionWrapper(fn) {
      definitionFunctionWrapper = fn;
    },
    setWorldConstructor: function setWorldConstructor(fn) {
      options.World = fn;
    }
  };
  fnArgument.Given = fnArgument.When = fnArgument.Then = fnArgument.defineStep;
  fns.forEach(function (fn) {
    return fn(fnArgument);
  });
  wrapDefinitions({
    cwd: cwd,
    definitionFunctionWrapper: definitionFunctionWrapper,
    definitions: _lodash2.default.chain(['afterFeaturesHook', 'afterScenarioHook', 'beforeFeaturesHook', 'beforeScenarioHook', 'step']).map(function (key) {
      return options[key + 'Definitions'];
    }).flatten().value()
  });
  options.afterScenarioHookDefinitions.reverse();
  options.afterFeaturesHookDefinitions.reverse();
  return options;
}

function wrapDefinitions(_ref3) {
  var cwd = _ref3.cwd,
      definitionFunctionWrapper = _ref3.definitionFunctionWrapper,
      definitions = _ref3.definitions;

  if (definitionFunctionWrapper) {
    definitions.forEach(function (definition) {
      var codeLength = definition.code.length;
      var wrappedFn = definitionFunctionWrapper(definition.code, definition.options.wrapperOptions);
      if (wrappedFn !== definition.code) {
        definition.code = (0, _utilArity2.default)(codeLength, wrappedFn);
      }
    });
  } else {
    var generatorDefinitions = _lodash2.default.filter(definitions, function (definition) {
      return _isGenerator2.default.fn(definition.code);
    });
    if (generatorDefinitions.length > 0) {
      var references = generatorDefinitions.map(function (definition) {
        return _path2.default.relative(cwd, definition.uri) + ':' + definition.line;
      }).join('\n  ');
      var message = '\n        The following hook/step definitions use generator functions:\n\n          ' + references + '\n\n        Use \'this.setDefinitionFunctionWrapper(fn)\' to wrap then in a function that returns a promise.\n        ';
      throw new Error(message);
    }
  }
}

exports.default = { build: build };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdXBwb3J0X2NvZGVfbGlicmFyeV9idWlsZGVyL2J1aWxkZXIuanMiXSwibmFtZXMiOlsiaGVscGVycyIsImJ1aWxkIiwiY3dkIiwiZm5zIiwib3B0aW9ucyIsImFmdGVyRmVhdHVyZXNIb29rRGVmaW5pdGlvbnMiLCJhZnRlclNjZW5hcmlvSG9va0RlZmluaXRpb25zIiwiYmVmb3JlRmVhdHVyZXNIb29rRGVmaW5pdGlvbnMiLCJiZWZvcmVTY2VuYXJpb0hvb2tEZWZpbml0aW9ucyIsImRlZmF1bHRUaW1lb3V0IiwibGlzdGVuZXJzIiwic3RlcERlZmluaXRpb25zIiwicGFyYW1ldGVyVHlwZVJlZ2lzdHJ5IiwiV29ybGQiLCJhdHRhY2giLCJwYXJhbWV0ZXJzIiwiZGVmaW5pdGlvbkZ1bmN0aW9uV3JhcHBlciIsImZuQXJndW1lbnQiLCJhZGRUcmFuc2Zvcm0iLCJkZWZpbmVQYXJhbWV0ZXJUeXBlIiwiQWZ0ZXIiLCJkZWZpbmVTY2VuYXJpb0hvb2siLCJBZnRlckFsbCIsImRlZmluZUZlYXR1cmVzSG9vayIsIkJlZm9yZSIsIkJlZm9yZUFsbCIsImRlZmluZVN0ZXAiLCJyZWdpc3RlckhhbmRsZXIiLCJyZWdpc3Rlckxpc3RlbmVyIiwibGlzdGVuZXIiLCJwdXNoIiwic2V0RGVmYXVsdFRpbWVvdXQiLCJtaWxsaXNlY29uZHMiLCJzZXREZWZpbml0aW9uRnVuY3Rpb25XcmFwcGVyIiwiZm4iLCJzZXRXb3JsZENvbnN0cnVjdG9yIiwiR2l2ZW4iLCJXaGVuIiwiVGhlbiIsImZvckVhY2giLCJ3cmFwRGVmaW5pdGlvbnMiLCJkZWZpbml0aW9ucyIsImNoYWluIiwibWFwIiwia2V5IiwiZmxhdHRlbiIsInZhbHVlIiwicmV2ZXJzZSIsImNvZGVMZW5ndGgiLCJkZWZpbml0aW9uIiwiY29kZSIsImxlbmd0aCIsIndyYXBwZWRGbiIsIndyYXBwZXJPcHRpb25zIiwiZ2VuZXJhdG9yRGVmaW5pdGlvbnMiLCJmaWx0ZXIiLCJyZWZlcmVuY2Vz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QUFGLEUiLCJmaWxlIjoiYnVpbGRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCdcbmltcG9ydCBhcml0eSBmcm9tICd1dGlsLWFyaXR5J1xuaW1wb3J0IGlzR2VuZXJhdG9yIGZyb20gJ2lzLWdlbmVyYXRvcidcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQgVHJhbnNmb3JtTG9va3VwQnVpbGRlciBmcm9tICcuL3BhcmFtZXRlcl90eXBlX3JlZ2lzdHJ5X2J1aWxkZXInXG5pbXBvcnQgKiBhcyBoZWxwZXJzIGZyb20gJy4vaGVscGVycydcbmZ1bmN0aW9uIGJ1aWxkKHsgY3dkLCBmbnMgfSkge1xuICBjb25zdCBvcHRpb25zID0ge1xuICAgIGFmdGVyRmVhdHVyZXNIb29rRGVmaW5pdGlvbnM6IFtdLFxuICAgIGFmdGVyU2NlbmFyaW9Ib29rRGVmaW5pdGlvbnM6IFtdLFxuICAgIGJlZm9yZUZlYXR1cmVzSG9va0RlZmluaXRpb25zOiBbXSxcbiAgICBiZWZvcmVTY2VuYXJpb0hvb2tEZWZpbml0aW9uczogW10sXG4gICAgZGVmYXVsdFRpbWVvdXQ6IDUwMDAsXG4gICAgbGlzdGVuZXJzOiBbXSxcbiAgICBzdGVwRGVmaW5pdGlvbnM6IFtdLFxuICAgIHBhcmFtZXRlclR5cGVSZWdpc3RyeTogVHJhbnNmb3JtTG9va3VwQnVpbGRlci5idWlsZCgpLFxuICAgIFdvcmxkKHsgYXR0YWNoLCBwYXJhbWV0ZXJzIH0pIHtcbiAgICAgIHRoaXMuYXR0YWNoID0gYXR0YWNoXG4gICAgICB0aGlzLnBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzXG4gICAgfVxuICB9XG4gIGxldCBkZWZpbml0aW9uRnVuY3Rpb25XcmFwcGVyID0gbnVsbFxuICBjb25zdCBmbkFyZ3VtZW50ID0ge1xuICAgIGFkZFRyYW5zZm9ybTogaGVscGVycy5hZGRUcmFuc2Zvcm0ob3B0aW9ucy5wYXJhbWV0ZXJUeXBlUmVnaXN0cnkpLFxuICAgIGRlZmluZVBhcmFtZXRlclR5cGU6IGhlbHBlcnMuZGVmaW5lUGFyYW1ldGVyVHlwZShcbiAgICAgIG9wdGlvbnMucGFyYW1ldGVyVHlwZVJlZ2lzdHJ5XG4gICAgKSxcbiAgICBBZnRlcjogaGVscGVycy5kZWZpbmVTY2VuYXJpb0hvb2soXG4gICAgICBjd2QsXG4gICAgICBvcHRpb25zLmFmdGVyU2NlbmFyaW9Ib29rRGVmaW5pdGlvbnNcbiAgICApLFxuICAgIEFmdGVyQWxsOiBoZWxwZXJzLmRlZmluZUZlYXR1cmVzSG9vayhcbiAgICAgIGN3ZCxcbiAgICAgIG9wdGlvbnMuYWZ0ZXJGZWF0dXJlc0hvb2tEZWZpbml0aW9uc1xuICAgICksXG4gICAgQmVmb3JlOiBoZWxwZXJzLmRlZmluZVNjZW5hcmlvSG9vayhcbiAgICAgIGN3ZCxcbiAgICAgIG9wdGlvbnMuYmVmb3JlU2NlbmFyaW9Ib29rRGVmaW5pdGlvbnNcbiAgICApLFxuICAgIEJlZm9yZUFsbDogaGVscGVycy5kZWZpbmVGZWF0dXJlc0hvb2soXG4gICAgICBjd2QsXG4gICAgICBvcHRpb25zLmJlZm9yZUZlYXR1cmVzSG9va0RlZmluaXRpb25zXG4gICAgKSxcbiAgICBkZWZpbmVTdGVwOiBoZWxwZXJzLmRlZmluZVN0ZXAoY3dkLCBvcHRpb25zLnN0ZXBEZWZpbml0aW9ucyksXG4gICAgcmVnaXN0ZXJIYW5kbGVyOiBoZWxwZXJzLnJlZ2lzdGVySGFuZGxlcihjd2QsIG9wdGlvbnMubGlzdGVuZXJzKSxcbiAgICByZWdpc3Rlckxpc3RlbmVyKGxpc3RlbmVyKSB7XG4gICAgICBvcHRpb25zLmxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKVxuICAgIH0sXG4gICAgc2V0RGVmYXVsdFRpbWVvdXQobWlsbGlzZWNvbmRzKSB7XG4gICAgICBvcHRpb25zLmRlZmF1bHRUaW1lb3V0ID0gbWlsbGlzZWNvbmRzXG4gICAgfSxcbiAgICBzZXREZWZpbml0aW9uRnVuY3Rpb25XcmFwcGVyKGZuKSB7XG4gICAgICBkZWZpbml0aW9uRnVuY3Rpb25XcmFwcGVyID0gZm5cbiAgICB9LFxuICAgIHNldFdvcmxkQ29uc3RydWN0b3IoZm4pIHtcbiAgICAgIG9wdGlvbnMuV29ybGQgPSBmblxuICAgIH1cbiAgfVxuICBmbkFyZ3VtZW50LkdpdmVuID0gZm5Bcmd1bWVudC5XaGVuID0gZm5Bcmd1bWVudC5UaGVuID0gZm5Bcmd1bWVudC5kZWZpbmVTdGVwXG4gIGZucy5mb3JFYWNoKGZuID0+IGZuKGZuQXJndW1lbnQpKVxuICB3cmFwRGVmaW5pdGlvbnMoe1xuICAgIGN3ZCxcbiAgICBkZWZpbml0aW9uRnVuY3Rpb25XcmFwcGVyLFxuICAgIGRlZmluaXRpb25zOiBfLmNoYWluKFtcbiAgICAgICdhZnRlckZlYXR1cmVzSG9vaycsXG4gICAgICAnYWZ0ZXJTY2VuYXJpb0hvb2snLFxuICAgICAgJ2JlZm9yZUZlYXR1cmVzSG9vaycsXG4gICAgICAnYmVmb3JlU2NlbmFyaW9Ib29rJyxcbiAgICAgICdzdGVwJ1xuICAgIF0pXG4gICAgICAubWFwKGtleSA9PiBvcHRpb25zW2tleSArICdEZWZpbml0aW9ucyddKVxuICAgICAgLmZsYXR0ZW4oKVxuICAgICAgLnZhbHVlKClcbiAgfSlcbiAgb3B0aW9ucy5hZnRlclNjZW5hcmlvSG9va0RlZmluaXRpb25zLnJldmVyc2UoKVxuICBvcHRpb25zLmFmdGVyRmVhdHVyZXNIb29rRGVmaW5pdGlvbnMucmV2ZXJzZSgpXG4gIHJldHVybiBvcHRpb25zXG59XG5cbmZ1bmN0aW9uIHdyYXBEZWZpbml0aW9ucyh7IGN3ZCwgZGVmaW5pdGlvbkZ1bmN0aW9uV3JhcHBlciwgZGVmaW5pdGlvbnMgfSkge1xuICBpZiAoZGVmaW5pdGlvbkZ1bmN0aW9uV3JhcHBlcikge1xuICAgIGRlZmluaXRpb25zLmZvckVhY2goZGVmaW5pdGlvbiA9PiB7XG4gICAgICBjb25zdCBjb2RlTGVuZ3RoID0gZGVmaW5pdGlvbi5jb2RlLmxlbmd0aFxuICAgICAgY29uc3Qgd3JhcHBlZEZuID0gZGVmaW5pdGlvbkZ1bmN0aW9uV3JhcHBlcihcbiAgICAgICAgZGVmaW5pdGlvbi5jb2RlLFxuICAgICAgICBkZWZpbml0aW9uLm9wdGlvbnMud3JhcHBlck9wdGlvbnNcbiAgICAgIClcbiAgICAgIGlmICh3cmFwcGVkRm4gIT09IGRlZmluaXRpb24uY29kZSkge1xuICAgICAgICBkZWZpbml0aW9uLmNvZGUgPSBhcml0eShjb2RlTGVuZ3RoLCB3cmFwcGVkRm4pXG4gICAgICB9XG4gICAgfSlcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBnZW5lcmF0b3JEZWZpbml0aW9ucyA9IF8uZmlsdGVyKGRlZmluaXRpb25zLCBkZWZpbml0aW9uID0+IHtcbiAgICAgIHJldHVybiBpc0dlbmVyYXRvci5mbihkZWZpbml0aW9uLmNvZGUpXG4gICAgfSlcbiAgICBpZiAoZ2VuZXJhdG9yRGVmaW5pdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgcmVmZXJlbmNlcyA9IGdlbmVyYXRvckRlZmluaXRpb25zXG4gICAgICAgIC5tYXAoZGVmaW5pdGlvbiA9PiB7XG4gICAgICAgICAgcmV0dXJuIHBhdGgucmVsYXRpdmUoY3dkLCBkZWZpbml0aW9uLnVyaSkgKyAnOicgKyBkZWZpbml0aW9uLmxpbmVcbiAgICAgICAgfSlcbiAgICAgICAgLmpvaW4oJ1xcbiAgJylcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgXG4gICAgICAgIFRoZSBmb2xsb3dpbmcgaG9vay9zdGVwIGRlZmluaXRpb25zIHVzZSBnZW5lcmF0b3IgZnVuY3Rpb25zOlxuXG4gICAgICAgICAgJHtyZWZlcmVuY2VzfVxuXG4gICAgICAgIFVzZSAndGhpcy5zZXREZWZpbml0aW9uRnVuY3Rpb25XcmFwcGVyKGZuKScgdG8gd3JhcCB0aGVuIGluIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgcHJvbWlzZS5cbiAgICAgICAgYFxuICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHsgYnVpbGQgfVxuIl19