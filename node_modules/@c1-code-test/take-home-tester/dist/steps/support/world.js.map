{"version":3,"sources":["../../../src/steps/support/world.js"],"names":["Before","setWorldConstructor","eventBroadcaster","runner","type","data","emit","resetRequest","attach","req","res","host","hostname","port","runConfig","request","defaults","json","useQuerystring","baseUrl","protocol","simple","resolveWithFullResponse","getResponse","updateRequest","obj","getResponseBody","promise","get"],"mappings":";;AAAA;;AACA;;AAEA;;;;AACA;;;;AACA;;;;AAEA,iCAAkB,CAAC,EAAEA,MAAF,EAAUC,mBAAV,EAA+BC,gBAA/B,EAAiDC,MAAjD,EAAD,KAA+D;AAC/E,wDAAwB,CAACC,IAAD,EAAOC,IAAP,KAAgBH,iBAAiBI,IAAjB,CAAsBF,IAAtB,EAA4BC,IAA5B,CAAxC;;AAEAL,SAAO,YAAY;AAAE,SAAKO,YAAL;AAAsB,GAA3C;;AAEAN,sBAAoB,UAAU,EAAEO,MAAF,EAAV,EAAsB;AACxC,QAAIC,GAAJ,EAASC,GAAT;;AAEA,UAAM,EAAEC,MAAMC,QAAR,EAAkBC,IAAlB,KAA2BV,OAAOW,SAAxC;AACA,UAAMC,UAAU,yBAASC,QAAT,CAAkB;AAChCC,YAAM,IAD0B;AAEhCC,sBAAgB,IAFgB;AAGhCC,eAAS,iBAAU,EAAEC,UAAU,MAAZ,EAAoBR,QAApB,EAA8BC,IAA9B,EAAV,CAHuB;AAIhCQ,cAAQ,KAJwB;AAKhCC,+BAAyB;AALO,KAAlB,CAAhB;;AAQA,aAASC,WAAT,GAAuB;AACrB,aAAOb,QAAQA,MAAMK,QAAQN,GAAR,CAAd,CAAP;AACD;;AAED,WAAO;AACLM,aADK;AAELP,YAFK;;AAILgB,oBAAcC,GAAd,EAAmB;AACjBhB,cAAM,2BAAeA,GAAf,EAAoBgB,GAApB,CAAN,CADiB,CACe;AACjC,OANI;;AAQLF,iBARK;AASLG,wBAAkB;AAChB,eAAOH,cAAcI,OAAd,GAAwBC,GAAxB,CAA4B,MAA5B,CAAP;AACD,OAXI;;AAaLrB,qBAAe;AACbE,cAAM,EAAN;AACAC,cAAM,IAAN;AACD;AAhBI,KAAP;AAkBD,GAlCD;AAmCD,CAxCD","file":"world.js","sourcesContent":["import { defineSupportCode } from 'cucumber';\nimport { mergeDeepRight } from 'ramda';\n\nimport debugRequests from 'request-debug';\nimport _request from 'request-promise';\nimport { format as formatUrl } from 'url';\n\ndefineSupportCode(({ Before, setWorldConstructor, eventBroadcaster, runner }) => {\n  debugRequests(_request, (type, data) => eventBroadcaster.emit(type, data));\n\n  Before(function () { this.resetRequest(); });\n\n  setWorldConstructor(function ({ attach }) {\n    let req, res;\n\n    const { host: hostname, port } = runner.runConfig;\n    const request = _request.defaults({\n      json: true,\n      useQuerystring: true,\n      baseUrl: formatUrl({ protocol: 'http', hostname, port }),\n      simple: false,\n      resolveWithFullResponse: true,\n    });\n\n    function getResponse() {\n      return res || (res = request(req));\n    }\n\n    return {\n      request,\n      attach,\n\n      updateRequest(obj) {\n        req = mergeDeepRight(req, obj); // request opts don't have any arrays, so this should do fine.\n      },\n\n      getResponse,\n      getResponseBody() {\n        return getResponse().promise().get('body');\n      },\n\n      resetRequest() {\n        req = {};\n        res = null;\n      },\n    };\n  });\n});\n"]}