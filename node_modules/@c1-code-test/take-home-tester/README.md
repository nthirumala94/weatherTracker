# Take Home Tester

This is a tool to run a suite of integration tests to be run against submissions for the Capital One Developer Evaluation (CODE) Take Home Test.

## Installation

`take-home-tester` is published as a [scoped package](https://docs.npmjs.com/misc/scope) under the `@c1-code-test` scope.
The `@c1-code-test` scope is used to associate packages to the Capital One internal npm registry provided by [Artifactory](https://artifactory.cloud.capitalone.com).

To add the `@c1-code-test` scope to your npm configuration (you only need to do this once, globally), run:

```shell
$ curl -sSu $USER https://artifactory.cloud.capitalone.com/artifactory/api/npm/npm-internalfacing/auth/cdi >> ~/.npmrc
```

Then you can install `@c1-code-test/take-home-tester` with `npm` or [`yarn`](https://yarnpkg.com/).

```shell
$ npm install --global @c1-code-test/take-home-tester

# Or

$ yarn global add @c1-code-test/take-home-tester
```

## Usage

The tester assumes the system under test (SUT) is in the current working directory.

```
$ take-home-integration-test --help

  Usage: take-home-integration-test [options] [feature-files...] [-- <cucumber-args ...>]


  Options:

    -p, --port <port>      The port to bind
    -h, --host <hostname>  The host to bind
    -c, --command <cmd>    The command to run to start the server
    -s, --score            Print the score
    -D, --no-debug         Disable debug output
    -C, --no-colors        Disable color output
    -h, --help             output usage information
```

`--command` is the only required argument and will be run in a sub-shell with the following environment variables:

|     Name     |             Value             |
| ------------ | ----------------------------- |
| `PATH`       | Inherited from parent context |
| `DEBUG`      | Inherited from parent context |
| `NODE_DEBUG` | Inherited from parent context |
| `PORT`       | Value of `--port`             |
| `HOST`       | Value of `--host`             |

For instance, you can run a NodeJS-based program like so:

```sh
$ take-home-integration-test --command 'npm start -- --port $PORT --host $HOST'
```

Note that in bash, you must use single quotes to prevent the variables from being interpolated in the parent shell.

If `feature-files` are specified, they will be run.
Otherwise, the included feature files will be run.

To enable debug logging, use:

```sh
$ DEBUG=take-home-tester:* take-home-integration-test --command <cmd>
```

All options specified after `--` are forwarded to the Cucumber CLI. Please see the [Cucumber docs](https://cucumber.io/docs/reference#command-line) for more detail.

```sh
$ take-home-integration-test -- --fail-fast
```

